<!doctype html>
<html>
<head>
	<title>Web RTC Demo - Video Chatting in room <%= rid %></title>
	<% include _header %>
  <link rel="stylesheet" href="/vendors/AdminLTE/css/skins/_all-skins.min.css">
	<link rel="stylesheet" href="/css/room.css" />
</head>
<body class="hold-transition skin-green-light sidebar-mini">
  <!-- Site wrapper -->
  <div class="wrapper">

    <header class="main-header">
      <!-- Logo -->
      <a href="/" class="logo">
        <!-- mini logo for sidebar mini 50x50 pixels -->
        <span class="logo-mini"><b>A</b>RTC</span>
        <!-- logo for regular state and mobile devices -->
        <span class="logo-lg"><b>AgilityFeat</b>RTC</span>
      </a>
      <!-- Header Navbar: style can be found in header.less -->
      <nav class="navbar navbar-static-top" role="navigation">
        <!-- Sidebar toggle button-->
        <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
        <div class="navbar-custom-menu">
	        <ul class="nav navbar-nav">
		        <!-- Notifications: style can be found in dropdown.less -->
		        <li class="dropdown notifications-menu">
		          <a href="#" class="dropdown-toggle" data-toggle="dropdown">
		            <i class="fa fa-bell-o"></i>
		          </a>
		          <ul class="dropdown-menu">
		            <li class="header">New users list</li>
		            <li>
		              <!-- inner menu: contains the actual data -->
		              <ul class="menu">
		              </ul>
		            </li>
		          </ul>
		        </li>
		        <li>
	            <a href="#" data-toggle="control-sidebar"><i class="fa fa-upload"></i></a>
	          </li>
					</ul>
        </div>
      </nav>
    </header>
    <!-- =============================================== -->

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Main content -->
      <section class="content">
	      <div id="streams_container">
	        <div class="streamContainer" id="myPublisherContainer">
	          <div id="myPublisher"></div>
	        </div>
	      </div>
      </section><!-- /.content -->
    </div><!-- /.content-wrapper -->

    <footer class="main-footer">
      <div class="pull-right hidden-xs">
        <b>Version</b> 0.0.1
      </div>
      <div class="help-block text-center">
  	    AgilityFeatRTC is a WebRTC Demo created for AgilityFeat, it supports video chat, audio/video and file sharing through WebRTC and OpenTok.
  	    It was created based on open source repository <strong><a href="https://github.com/opentok/OpenTokRTC" class="text-black">OpenTokRTC</a></strong>
  	  </div>
    </footer>
    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
      <!-- Create the tabs -->
      <ul class="nav nav-tabs nav-justified control-sidebar-tabs">
        <li class="active"><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li>
        <li><a href="#control-sidebar-settings-tab" data-toggle="tab"><i class="fa fa-gears"></i></a></li>
      </ul>
      <!-- Tab panes -->
      <div class="tab-content">
        <!-- Home tab content -->
        <div class="tab-pane active" id="control-sidebar-home-tab">
          <h3 class="control-sidebar-heading">Upload Files using WebRTC DataChannel</h3>
          <ul class="control-sidebar-menu">
            <li>
            	<form role="form">
	              <div class="box-body">
	                <div class="form-group">
	                  <label for="exampleInputFile">File input</label>
	                  <input type="file" id="exampleInputFile">

	                  <p class="help-block">Example block-level help text here.</p>
	                </div>
	              </div>
	              <!-- /.box-body -->

	              <div class="box-footer">
	                <button type="submit" class="btn btn-primary">Submit</button>
	              </div>
	            </form>
            </li>
          </ul><!-- /.control-sidebar-menu -->

          <h3 class="control-sidebar-heading">Tasks Progress</h3>
          <ul class="control-sidebar-menu">
            <li>
              <a href="javascript::;">
                <h4 class="control-sidebar-subheading">
                  Apply to AgilityFeat
                  <span class="label label-success pull-right">95%</span>
                </h4>
                <div class="progress progress-xxs">
                  <div class="progress-bar progress-bar-success" style="width: 95%"></div>
                </div>
              </a>
            </li>
            <li>
              <a href="javascript::;">
                <h4 class="control-sidebar-subheading">
                  Learn Reactive Extensions
                  <span class="label label-warning pull-right">50%</span>
                </h4>
                <div class="progress progress-xxs">
                  <div class="progress-bar progress-bar-warning" style="width: 50%"></div>
                </div>
              </a>
            </li>
            <li>
              <a href="javascript::;">
                <h4 class="control-sidebar-subheading">
                  Learn Ruby and Scala
                  <span class="label label-primary pull-right">23%</span>
                </h4>
                <div class="progress progress-xxs">
                  <div class="progress-bar progress-bar-primary" style="width: 23%"></div>
                </div>
              </a>
            </li>
          </ul><!-- /.control-sidebar-menu -->

        </div><!-- /.tab-pane -->

        <!-- Settings tab content -->
        <div class="tab-pane" id="control-sidebar-settings-tab">
          <form method="post">
            <h3 class="control-sidebar-heading">General Settings</h3>
            <div class="form-group">
              <label class="control-sidebar-subheading">
                Report panel usage
                <input type="checkbox" class="pull-right" checked>
              </label>
              <p>
                Some information about this general settings option
              </p>
            </div><!-- /.form-group -->

            <div class="form-group">
              <label class="control-sidebar-subheading">
                Allow mail redirect
                <input type="checkbox" class="pull-right" checked>
              </label>
              <p>
                Other sets of options are available
              </p>
            </div><!-- /.form-group -->

            <div class="form-group">
              <label class="control-sidebar-subheading">
                Expose author name in posts
                <input type="checkbox" class="pull-right" checked>
              </label>
              <p>
                Allow the user to show his name in blog posts
              </p>
            </div><!-- /.form-group -->

            <h3 class="control-sidebar-heading">Chat Settings</h3>

            <div class="form-group">
              <label class="control-sidebar-subheading">
                Show me as online
                <input type="checkbox" class="pull-right" checked>
              </label>
            </div><!-- /.form-group -->

            <div class="form-group">
              <label class="control-sidebar-subheading">
                Turn off notifications
                <input type="checkbox" class="pull-right">
              </label>
            </div><!-- /.form-group -->

            <div class="form-group">
              <label class="control-sidebar-subheading">
                Delete chat history
                <a href="javascript::;" class="text-red pull-right"><i class="fa fa-trash-o"></i></a>
              </label>
            </div><!-- /.form-group -->
          </form>
        </div><!-- /.tab-pane -->
      </div>
    </aside><!-- /.control-sidebar -->
    <!-- Add the sidebar's background. This div must be placed
         immediately after the control sidebar -->
    <div class="control-sidebar-bg"></div>

  </div><!-- ./wrapper -->

  <script id="userStreamTemplate" type="text/x-handlebars-template">
    <div class="streamContainer {{id}}" data-connectionid="{{connectionId}}">
      <div id="{{id}}"></div>
      <div class="flagUser" data-streamconnection="{{id}}">Remove User</div>
    </div>
  </script>
  <script id="chattrNewUserTpl" type="text/x-handlebars-template">
	  <li>
	    <a href="#">
	      <i class="fa fa-users text-aqua"></i> {{nickname}} has joined the room
	    </a>
	  </li>
  </script>
  <script id="chattrUserLeaveTpl" type="text/x-handlebars-template">
	  <li>
	    <a href="#">
	      <i class="fa fa-users text-red"></i> {{nickname}} has left the room
	    </a>
	  </li>
  </script>
  <% include _vendor %>
	<script src="//static.opentok.com/v2.2/js/opentok.min.js"></script>
	<script src="/vendors/handlebars.js" type="text/javascript"></script>
	<script src="/js/layoutContainer.js" type="text/javascript"></script>
	<script src="/vendors/jquery.event.ue.js" type="text/javascript"></script>
	<script src="/vendors/jquery.udraggable.js" type="text/javascript"></script>
	<script src="/vendors/ZeroClipboard/ZeroClipboard.min.js" type="text/javascript"></script>
	<script src="/js/OpenTokChattr.js" type="text/javascript"></script>
	<script src="/js/room.js" type="text/javascript"></script>
	<script type="text/javascript">
	  var session = OT.initSession( "<%= apiKey %>", "<%= sid %>" );
	  chattr = new OpenTokChattr("body","<%= rid %>",session,
	 {"draggable": true,
	  "startPosition":{
	    x: startX,
	    y: startY
	  },
	  "closeable": function(){
	    $("#chattr").hide();
	    $("#chatButton").removeClass("selected");
	  }
	 });
	  room = new Room("<%= rid %>", session, "<%= token %>", chattr);
	  var startX = $(window).width()-10-$("#chattr").width();
	  var startY = $(window).height()-56-$("#chattr").height();
	  $('#filtersButton').popover();
	  $(".controlOption").each(function(){
	    $(this).tooltip({
	      title: $(this).data("tooltip-title"),
	      placement: "top"
	    });
	  });
	  $('body').on('click', function (e) {
	    $('.popover-dismiss').each(function () {
	        //the 'is' for buttons that trigger popups
	        //the 'has' for icons within a button that triggers a popup
	        if (!$(this).is(e.target) && $(this).has(e.target).length === 0 && $('.popover').has(e.target).length === 0) {
	            $(this).popover('hide');
	            $(this).removeClass('selected');
	        }
	    });
	  });
	  $("#roomLinkButton").popover({
	    title: $(this).attr("title"),
	    content: "<input id='roomLinkInput' type='text' value='"+window.location.origin+"/<%= rid %>' ><button id='copyButton'>Copy</button>",
	    html: true
	  });
	  $("#roomLinkButton").on('shown.bs.popover', function(){
	    var client = new ZeroClipboard($("#copyButton"));
	    client.on("ready", function(readyEvent){
	      client.on("copy", function(event){
	        var clipboard = event.clipboardData;
	        clipboard.setData( "text/plain", window.location.origin+"/<%= rid %>" );
	      });
	      client.on("aftercopy", function(event){
	        $("#copyButton").html("Copied!");
	      });
	    });
	  });
	  $(".controlOption").click(function(){
	    $(this).toggleClass("selected");
	  });
	</script>
</body>
</html>